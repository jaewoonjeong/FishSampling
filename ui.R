library(shiny);  library(reshape2); library(ICC)

ui <-fluidPage(
  img(src="FishSampling.png"),
  navbarPage("",
             tabPanel(strong("HOME"),                      
                      p(""),
                      strong("This tool informs fish sampling strategies, we present an open web-based application which estimates sampling accuracy related to sea louse abundance, given inputs (such as presumed abundance or clustering effect) provided by the user"),
                      p("Scenario 1-A. With a given sample size, what range of abundance is expected?"),
                      p("Scenario 1-B. How many fish should be sampled to estimate abundance with a given margin of error?"),
                      p("Scenario 2-A. With a given sample size, how probable is a difference between two levels of abundance detected?"),
                      p("Scenario 2-B. How many fish should be sampled to detect a difference between two levels of abundance?"),
                      p("Scenario 3-B. With a given sample size, how probable is a correct decision made to conduct an intervention?"),
                      p("Scenario 3-B. How many fish should be sampled to make a correct decision for an intervention with a given probability?"),
                      p(""),
                      p(""),
                      strong("Table. Summary of Scenarios"),
                      p(""),
                      img(src="Scenario table.png", height = 300, width = 600),
                      p(""),
                      p("R shiny code is available from here, https://github.com/jaewoonjeong/FishSampling"),
                      p(""),
                      p(""),
                      p(""),
                      img(src="UPEI Logo_no background.png", height = 130, width = 270),
                      img(src="CERC.png", height = 130, width = 270),
                      img(src="ofi.jpg", height = 130, width = 270),
                      p("Please send any comments, questions or suggestions to Jaewoon Jeong (jjeong@upei.ca)")),
             tabPanel(strong("SCENARIO: 1-A"), 
                      h4("With a given sample size, what range of abundance is expected from the sampling?"),
                      fluidPage(
                        column(4,
                               radioButtons("clustering1A", "Clustering Effect:",c(No = "no", Yes = "yes")),
                               conditionalPanel(condition = "input.clustering1A == 'no'",numericInput("ab.1A", "True Abundance:", value =1.5, min=0, max=10, step=0.01)),
                               conditionalPanel(condition = "input.clustering1A == 'yes'",strong("Average True Abundance of Pens:")),
                               conditionalPanel(condition = "input.clustering1A == 'yes'",textOutput('Text.1A.1')),
                               conditionalPanel(condition = "input.clustering1A == 'yes'",strong("ICC:")),
                               conditionalPanel(condition = "input.clustering1A == 'yes'",textOutput("Text.1A.2"))),
                        column(4,
                               sliderInput("pen.1A", "Number of pens in a farm:", value=10, min=1, max=20),
                               selectInput("choice.1A", "Numbers of pens to be sampled:", choices =1:20, multiple = TRUE),
                               numericInput("iteration.1A","Iteration",value =c(100),min=1,max=100000)),
                        column(4,
                               numericInput("total.sample.size.1A","Total Sample Size",30,min=0,max=10000,step=1))),
                      sidebarLayout(sidebarPanel(width = 4,
                                     conditionalPanel(condition = "input.clustering1A == 'yes'",uiOutput("ui.1A.1")),
                                     conditionalPanel(condition = "input.clustering1A == 'yes'",tags$i("The number of abundance must be same to the number of pens in a farm")),
                                     conditionalPanel(condition = "input.clustering1A == 'yes'",plotOutput("Plot.1A.2"))),
                        mainPanel(
                          actionButton("goButton.1A", "Go!"),
                          plotOutput("Plot.1A.1")
                          #tableOutput("Table.1A.1")
                          ))),
             tabPanel(strong("SCENARIO: 1-B"), 
                      h4("How many fish should be sampled to estimate abundance with a given margin of error?"),
                      fluidPage(
                        column(4,
                               radioButtons("clustering1B", "Clustering Effect:",c(No = "no", Yes = "yes")),
                               conditionalPanel(condition = "input.clustering1B == 'no'",numericInput("ab.1B", "True Abundance:", value = 1.5, min=0, max=100, step=0.01)),
                               conditionalPanel(condition = "input.clustering1B == 'yes'",strong("Average True Abundance of Pens:")),
                               conditionalPanel(condition = "input.clustering1B == 'yes'",textOutput('Text.1B.1')),
                               conditionalPanel(condition = "input.clustering1B == 'yes'",strong("ICC:")),
                               conditionalPanel(condition = "input.clustering1B == 'yes'",textOutput("Text.1B.2"))),
                        column(4,
                               sliderInput("pen.1B", "Number of pens in a farm:", value=10, min=1, max=20),
                               selectInput("choice.1B", "Numbers of pens to be sampled:", choices =1:20, multiple = TRUE),
                               numericInput("iteration.1B","Iteration",100,min=1,max=100000)),
                        column(4,
                               sliderInput("range.1B", "Range of number of sampled fish per Pen:",min = 1, max = 30,value = c(1,30)),
                               sliderInput("cl.1B","Confidence Level:", min=0, max=1,  value = 0.9, step=0.01),
                               numericInput("u.m","Upper Margin",0.3,min=0,max=10,step=0.01),
                               numericInput("l.m","Lower Margin",0.3,min=0,max=10,step=0.01))),
                      sidebarLayout(sidebarPanel(width = 4,
                                     conditionalPanel(condition = "input.clustering1B == 'yes'",uiOutput("ui.1B.1")),
                                     conditionalPanel(condition = "input.clustering1B == 'yes'",tags$i("The number of abundance must be same to the number of pens in a farm")),
                                     conditionalPanel(condition = "input.clustering1B == 'yes'",plotOutput("Plot.1B.2"))),
                        mainPanel(
                          actionButton("goButton.1B", "Go!"),
                          plotOutput("Plot.1B.1")
                          #tableOutput("Table.1B.1")
                          ))),
             tabPanel(strong("SCENARIO: 2-A"), 
                      h4("With a given sample size, how probable is a difference between two levels of abundance detected?"),
                      fluidPage(
                        column(4,
                               radioButtons("clustering2A", "Clustering Effect:",c(No = "no", Yes = "yes")),
                               conditionalPanel(condition = "input.clustering2A == 'no'",numericInput("ab1.2A", "True Abundance 1:", value =1.5, min=0, max=10, step=0.01)),
                               conditionalPanel(condition = "input.clustering2A == 'no'",numericInput("ab2.2A", "True Abundance 2:", value =2.0, min=0, max=10, step=0.01)),
                               selectInput("ab.standard.2A", "Abundance of Interest:", choices = c("Lower Abundance","Higher Abundance")),
                               conditionalPanel(condition = "input.clustering2A == 'yes'",strong("Average True Abundance 1 of Pens:")),
                               conditionalPanel(condition = "input.clustering2A == 'yes'",textOutput('Text.2A.1')),
                               conditionalPanel(condition = "input.clustering2A == 'yes'",strong("Average True Abundance 2 of Pens:")),
                               conditionalPanel(condition = "input.clustering2A == 'yes'",textOutput('Text.2A.2')),
                               conditionalPanel(condition = "input.clustering2A == 'yes'",strong("ICC1:")),
                               conditionalPanel(condition = "input.clustering2A == 'yes'",textOutput("Text.2A.3")),
                               conditionalPanel(condition = "input.clustering2A == 'yes'",strong("ICC2:")),
                               conditionalPanel(condition = "input.clustering2A == 'yes'",textOutput("Text.2A.4"))),
                        column(4,
                               sliderInput("pen.2A", "Number of pens in a farm:", value=10, min=1, max=20),
                               selectInput("choice.2A", "Numbers of pens to be sampled:", choices =1:20, multiple = TRUE),
                               numericInput("iteration.2A","Iteration",value =c(100),min=1,max=100000)),
                        column(4,
                               numericInput("total.sample.size.2A","Total Sample Size",60,min=0,max=10000,step=1))),
                      sidebarLayout(sidebarPanel(width = 4,
                                     conditionalPanel(condition = "input.clustering2A == 'yes'",uiOutput("ui.2A.1")),
                                     conditionalPanel(condition = "input.clustering2A == 'yes'",uiOutput("ui.2A.2")),
                                     conditionalPanel(condition = "input.clustering2A == 'yes'",tags$i("The number of abundance must be same to the number of pens in a farm")),
                                     conditionalPanel(condition = "input.clustering2A == 'yes'",plotOutput("Plot.2A.1")),
                                     conditionalPanel(condition = "input.clustering2A == 'yes'",plotOutput("Plot.2A.2"))),
                        mainPanel(
                          actionButton("goButton.2A", "Go!"),
                          plotOutput("Plot.2A.3"),
                          plotOutput("Plot.2A.4")
                          #h4("Statistical Power"),
                          #tableOutput("Table.2A.1"),
                          #h4("Critical Value"),
                          #tableOutput("Table.2A.2")
                          ))),
             tabPanel(strong("SCENARIO: 2-B"), 
                      h4("How many fish should be sampled to detect a difference between two levels of abundance?"),
                      fluidPage(
                        column(4,
                               radioButtons("clustering2B", "Clustering Effect:",c(No = "no", Yes = "yes")),
                               conditionalPanel(condition = "input.clustering2B == 'no'",numericInput("ab1.2B", "True Abundance 1:", value =1.5, min=0, max=10, step=0.01)),
                               conditionalPanel(condition = "input.clustering2B == 'no'",numericInput("ab2.2B", "True Abundance 2:", value =2.0, min=0, max=10, step=0.01)),
                               selectInput("ab.standard.2B", "Abundance of Interest:", choices = c("Lower Abundance","Higher Abundance")),
                               conditionalPanel(condition = "input.clustering2B == 'yes'",strong("Average True Abundance 1 of Pens:")),
                               conditionalPanel(condition = "input.clustering2B == 'yes'",textOutput('Text.2B.1')),
                               conditionalPanel(condition = "input.clustering2B == 'yes'",strong("Average True Abundance 2 of Pens:")),
                               conditionalPanel(condition = "input.clustering2B == 'yes'",textOutput('Text.2B.2')),
                               conditionalPanel(condition = "input.clustering2B == 'yes'",strong("ICC1:")),
                               conditionalPanel(condition = "input.clustering2B == 'yes'",textOutput("Text.2B.3")),
                               conditionalPanel(condition = "input.clustering2B == 'yes'",strong("ICC2:")),
                               conditionalPanel(condition = "input.clustering2B == 'yes'",textOutput("Text.2B.4"))),
                        column(4,
                               sliderInput("pen.2B", "Number of pens in a farm:", value=10, min=1, max=20),
                               selectInput("choice.2B", "Numbers of pens to be sampled:", choices =1:20, multiple = TRUE),
                               numericInput("iteration.2B","Iteration",100,min=1,max=100000)),
                        column(4,
                               sliderInput("range.2B", "Range of number of sampled fish per Pen:",min = 1, max = 30,value = c(1,30)),
                               sliderInput("cl.2B","Confidence Level:", min=0, max=1,  value = 0.9, step=0.01))),
                      sidebarLayout(sidebarPanel(width = 4,
                                     conditionalPanel(condition = "input.clustering2B == 'yes'",uiOutput("ui.2B.1")),
                                     conditionalPanel(condition = "input.clustering2B == 'yes'",uiOutput("ui.2B.2")),
                                     conditionalPanel(condition = "input.clustering2B == 'yes'",tags$i("The number of abundance must be same to the number of pens in a farm")),
                                     conditionalPanel(condition = "input.clustering2B == 'yes'",plotOutput("Plot.2B.1")),
                                     conditionalPanel(condition = "input.clustering2B == 'yes'",plotOutput("Plot.2B.2"))),
                        mainPanel(
                          actionButton("goButton.2B", "Go!"),
                          plotOutput("Plot.2B.3")
                          #tableOutput("Table.2B.1")
                          ))),
             tabPanel(strong("SCENARIO: 3-A"), 
                      h4("With a given sample size, how probable is a correct decision made to conduct an intervention?"),
                      fluidPage(
                        column(4,
                               radioButtons("clustering3A", "Clustering Effect:",c(No = "no", Yes = "yes")),
                               conditionalPanel(condition = "input.clustering3A == 'no'",numericInput("ab.3A", "True Abundance:", value =0.6, min=0, max=10, step=0.01)),
                               conditionalPanel(condition = "input.clustering3A == 'yes'",strong("Average True Abundance of Pens:")),
                               conditionalPanel(condition = "input.clustering3A == 'yes'",textOutput('Text.3A.1')),
                               conditionalPanel(condition = "input.clustering3A == 'yes'",strong("ICC:")),
                               conditionalPanel(condition = "input.clustering3A == 'yes'",textOutput("Text.3A.2"))),
                        column(4,
                               sliderInput("pen.3A", "Number of pens in a farm:", value=10, min=1, max=20),
                               selectInput("choice.3A", "Numbers of pens to be sampled:", choices =1:20, multiple = TRUE),
                               numericInput("iteration.3A","Iteration",value =c(100),min=1,max=100000)),
                        column(4,
                               numericInput("total.sample.size.3A","Total Sample Size",100,min=0,max=10000,step=1),
                               numericInput("th.3A","Threshold:", 0.5, min=0, max=10, step=0.01))),
                      sidebarLayout(sidebarPanel(width = 4,
                                     conditionalPanel(condition = "input.clustering3A == 'yes'",uiOutput("ui.3A.1")),
                                     conditionalPanel(condition = "input.clustering3A == 'yes'",tags$i("The number of abundance must be same to the number of pens in a farm")),
                                     conditionalPanel(condition = "input.clustering3A == 'yes'",plotOutput("Plot.3A.2"))),
                        mainPanel(
                          actionButton("goButton.3A", "Go!"),
                          p("Probability of correct decision"),
                          plotOutput("Plot.3A.1")
                          #tableOutput("Table.3A.1")
                          ))), 
             tabPanel(strong("SCENARIO: 3-B"), 
                      h4("How many fish should be sampled to make a correct decision for an intervention with a probability?"),
                      fluidPage(
                        column(4,
                               radioButtons("clustering3B", "Clustering Effect:",c(No = "no", Yes = "yes")),
                               conditionalPanel(condition = "input.clustering3B == 'no'",numericInput("ab.3B", "True Abundance:", value = 0.6, min=0, max=10, step=0.01)),
                               conditionalPanel(condition = "input.clustering3B == 'yes'",strong("Average True Abundance of Pens:")),
                               conditionalPanel(condition = "input.clustering3B == 'yes'",textOutput('Text.3B.1')),
                               conditionalPanel(condition = "input.clustering3B == 'yes'",strong("ICC:")),
                               conditionalPanel(condition = "input.clustering3B == 'yes'",textOutput("Text.3B.2"))),
                        column(4, 
                               sliderInput("pen.3B", "Number of pens in a farm:", value=10, min=1, max=20),
                               selectInput("choice.3B", "Numbers of pens to be sampled:", choices =1:20, multiple = TRUE),
                               numericInput("iteration.3B","Iteration",10,min=1,max=100000)),
                        column(4,
                               sliderInput("range.3B", "Range of number of sampled fish per Pen:",min = 1, max = 30,value = c(1,30)),
                               sliderInput("cl.3B","Confidence Level:", min=0, max=1,  value = 0.9, step=0.01),
                               numericInput("th.3B","Threshold:",0.5,min=0,max=10,step=0.01))),
                      sidebarLayout(
                        sidebarPanel(width=4,
                                     conditionalPanel(condition = "input.clustering3B == 'yes'",uiOutput("ui.3B.1")),
                                     conditionalPanel(condition = "input.clustering3B == 'yes'",tags$i("The number of abundance must be same to the number of pens in a farm")),
                                     conditionalPanel(condition = "input.clustering3B == 'yes'",plotOutput("Plot.3B.2"))),
                        mainPanel(
                          actionButton("goButton.3B", "Go!"),
                          p("Probability of correct decision"),
                          plotOutput("Plot.3B.1"),
                          p("Minimum number of sampled fish per pen")
                          #tableOutput("Table.3B.1")
                          ))),
             tabPanel(strong("Glossary"), 
                      fluidPage(
                        strong("True Abundance:"),
                        p("Number of sea lice per salmon"),
                        strong("Confidence Level: "),
                        p("A percentage that reveals how confident you can be that the population would select an answer within a certain range. For example, a 80% confidence level means that you can be 80% certain the results lie between x and y numbers"),
                        strong("Critical Value: "),
                        p("A level of abundance that is compared to the assumed abundance to determine whether to determine whether there is a difference in two levels of abundance. If your abundance A is greater than the critical value, you can declare that abundance A are significantly higher than abundance B."),
                        strong("Farm: "),
                        p("A farm consists of a group of pens"),
                        strong("ICC (Intraclass correlation coefficient): "), 
                        p("The degree of clustering of sea lice infections in fish within cages. High ICC means that abundance is highly different from pen to pen, while no ICC means that all pens in a farm have exactly same abundance."),
                        strong("Iteration: "),
                        p("How many times the model is simulated to generate the output"),
                        strong("Margin of Error: "),
                        p("The acceptable range of error plus and minus to abundance. The smaller the margin of error, the closer you are to having the exact answer at a given confidence level but you need larger sample size. For information, see below"),
                        strong("Pen:"),
                        p("An enclosure for fish. A farm consists of multiple pens"),
                        strong("Power: "),
                        p("The ability to detect a difference between groups when a difference actually exists. By convention, most literature uses a value of 80~90% power."),
                        strong("Range of Sample Size: "),
                        p("Users can determine the range of number of sampled fish per pen between 1 and 20"),
                        strong("Numbers of pens to be sampled:"),
                        p("Users can determine from how many pens they sample salmon. When salmon are sampled from partial number of pens, ICC may affect the modelling results"),
                        p("")))
  ) # navbarPage
) # fluidpage